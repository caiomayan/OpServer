<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Força VPN - Teste Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">🔥 Força VPN - Teste Final</h1>
        
        <!-- Simulate both pages elements -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Main Page Simulation -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4">📋 Página Principal</h2>
                
                <!-- Main page elements -->
                <div id="main-server-count" class="text-6xl font-bold text-green-400 text-center mb-4">01</div>
                
                <!-- VPN Indicator for main page -->
                <div id="main-vpn-indicator" class="mt-4 flex items-center justify-center space-x-1 text-xs text-amber-500 opacity-0 transition-opacity duration-300" style="display: none;">
                    <span>🔌</span>
                    <span data-en="VPN Server" data-pt="Servidor VPN">Servidor VPN</span>
                </div>
                
                <div class="mt-4 text-center">
                    <div class="text-sm text-gray-400">Estado: <span id="main-status">Aguardando...</span></div>
                </div>
            </div>
            
            <!-- Servers Page Simulation -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4">🖥️ Página de Servidores</h2>
                
                <!-- Server page elements -->
                <div id="server-status-text" class="text-center mb-4">Status do Servidor</div>
                
                <!-- VPN Indicator for servers page -->
                <div id="vpn-indicator" class="flex items-center space-x-2 p-3 bg-amber-500/10 border border-amber-500/20 rounded-lg" style="display: none;">
                    <div class="w-4 h-4 bg-amber-500 rounded-full flex items-center justify-center">
                        <span class="text-xs">🔌</span>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-amber-400">Servidor VPN Detectado</div>
                        <div class="text-xs text-amber-500/80">Este servidor utiliza rede privada/VPN</div>
                    </div>
                </div>
                
                <div class="mt-4 text-center">
                    <div class="text-sm text-gray-400">Estado: <span id="server-status">Aguardando...</span></div>
                </div>
            </div>
        </div>
        
        <!-- Controls -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">🎮 Controles</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <button id="auto-test" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded">
                    🤖 Teste Automático
                </button>
                <button id="force-vpn" class="bg-amber-500 hover:bg-amber-600 px-4 py-2 rounded">
                    🔌 Forçar VPN
                </button>
                <button id="manual-update" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded">
                    🔄 Update Manual
                </button>
                <button id="reset-all" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded">
                    🔄 Reset Tudo
                </button>
            </div>
            
            <div class="text-center">
                <div id="test-result" class="text-lg font-semibold">⏳ Clique em "Teste Automático" para iniciar</div>
            </div>
        </div>
        
        <!-- Log -->
        <div class="bg-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4">📋 Log de Execução</h2>
            <div id="execution-log" class="bg-black rounded p-4 font-mono text-xs text-green-400 h-48 overflow-y-auto whitespace-pre-wrap"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./src/server-cache.js"></script>
    <script type="module" src="./src/cs2-server-status.js"></script>
    
    <script>
        let executionLog = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            executionLog.push(logEntry);
            
            const logElement = document.getElementById('execution-log');
            logElement.textContent = executionLog.join('\n');
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(logEntry);
        }
        
        function updateIndicatorStatus() {
            const mainIndicator = document.getElementById('main-vpn-indicator');
            const serverIndicator = document.getElementById('vpn-indicator');
            
            const mainVisible = mainIndicator.style.display === 'flex';
            const serverVisible = serverIndicator.style.display === 'flex';
            
            document.getElementById('main-status').textContent = mainVisible ? '🔌 VPN Visível' : '❌ VPN Oculto';
            document.getElementById('server-status').textContent = serverVisible ? '🔌 VPN Visível' : '❌ VPN Oculto';
            
            if (mainVisible && serverVisible) {
                document.getElementById('test-result').innerHTML = '<span class="text-green-400">✅ SUCESSO! Ambos indicadores VPN visíveis</span>';
            } else if (mainVisible || serverVisible) {
                document.getElementById('test-result').innerHTML = '<span class="text-yellow-400">⚠️ PARCIAL! Apenas um indicador visível</span>';
            } else {
                document.getElementById('test-result').innerHTML = '<span class="text-red-400">❌ FALHA! Nenhum indicador visível</span>';
            }
        }
        
        // Auto test
        document.getElementById('auto-test').addEventListener('click', async () => {
            log('🤖 INICIANDO TESTE AUTOMÁTICO...');
            document.getElementById('test-result').innerHTML = '<span class="text-blue-400">🔄 Executando teste automático...</span>';
            
            try {
                // Step 1: Check system
                log('1. Verificando sistema CS2ServerStatus...');
                if (!window.cs2ServerStatus) {
                    throw new Error('CS2ServerStatus não disponível');
                }
                log('✅ CS2ServerStatus encontrado');
                
                // Step 2: Check VPN detection
                log('2. Testando detecção VPN...');
                const isVPN = window.cs2ServerStatus.isPrivateNetworkIP('26.115.124.39');
                if (!isVPN) {
                    throw new Error('Detecção VPN falhou');
                }
                log('✅ Detecção VPN funcionando');
                
                // Step 3: Get VPN data
                log('3. Obtendo dados VPN...');
                const vpnData = window.cs2ServerStatus.getVpnServerData();
                if (vpnData.status !== 'vpn') {
                    throw new Error('Dados VPN inválidos');
                }
                log('✅ Dados VPN válidos');
                
                // Step 4: Force update VPN indicators
                log('4. Forçando update dos indicadores VPN...');
                window.cs2ServerStatus.updateVpnIndicators(vpnData);
                log('✅ Update de indicadores executado');
                
                // Step 5: Check visibility
                await new Promise(resolve => setTimeout(resolve, 500)); // Wait for UI update
                updateIndicatorStatus();
                
                log('🎉 TESTE AUTOMÁTICO CONCLUÍDO!');
                
            } catch (error) {
                log(`❌ ERRO NO TESTE AUTOMÁTICO: ${error.message}`);
                document.getElementById('test-result').innerHTML = `<span class="text-red-400">❌ FALHA: ${error.message}</span>`;
            }
        });
        
        // Force VPN
        document.getElementById('force-vpn').addEventListener('click', () => {
            log('🔌 Forçando ativação VPN...');
            
            const vpnData = {
                status: 'vpn',
                name: 'A GREAT CHAOS 01',
                isVpnServer: true
            };
            
            if (window.cs2ServerStatus) {
                window.cs2ServerStatus.updateVpnIndicators(vpnData);
                log('✅ updateVpnIndicators() executado');
            } else {
                // Manual fallback
                const mainIndicator = document.getElementById('main-vpn-indicator');
                const serverIndicator = document.getElementById('vpn-indicator');
                
                mainIndicator.style.display = 'flex';
                mainIndicator.style.opacity = '1';
                serverIndicator.style.display = 'flex';
                
                log('✅ Ativação manual executada');
            }
            
            updateIndicatorStatus();
        });
        
        // Manual update
        document.getElementById('manual-update').addEventListener('click', async () => {
            log('🔄 Executando update manual...');
            
            if (!window.cs2ServerStatus) {
                log('❌ CS2ServerStatus não disponível');
                return;
            }
            
            try {
                const data = await window.cs2ServerStatus.fetchServerData();
                log(`📊 Dados recebidos: ${JSON.stringify(data)}`);
                
                window.cs2ServerStatus.updateUI(data);
                log('✅ UI atualizada');
                
                updateIndicatorStatus();
                
            } catch (error) {
                log(`❌ Erro no update manual: ${error.message}`);
            }
        });
        
        // Reset
        document.getElementById('reset-all').addEventListener('click', () => {
            log('🔄 Resetando todos os indicadores...');
            
            const mainIndicator = document.getElementById('main-vpn-indicator');
            const serverIndicator = document.getElementById('vpn-indicator');
            
            mainIndicator.style.display = 'none';
            mainIndicator.style.opacity = '0';
            serverIndicator.style.display = 'none';
            
            updateIndicatorStatus();
            log('✅ Reset concluído');
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            log('🚀 Sistema inicializado');
            updateIndicatorStatus();
            
            // Auto-run test after system loads
            setTimeout(() => {
                if (window.cs2ServerStatus) {
                    log('⚡ Sistema detectado, executando teste automático...');
                    document.getElementById('auto-test').click();
                } else {
                    log('⏳ Aguardando carregamento do sistema...');
                    // Try again in 2 seconds
                    setTimeout(() => {
                        if (window.cs2ServerStatus) {
                            document.getElementById('auto-test').click();
                        } else {
                            log('❌ Sistema não carregou após timeout');
                        }
                    }, 2000);
                }
            }, 1500);
        });
    </script>
</body>
</html>
